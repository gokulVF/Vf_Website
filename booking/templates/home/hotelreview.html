{% load static %}
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zxx">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Review of Hotels</title>
     <!-- Favicon -->
     <link rel="shortcut icon" type="image/x-icon" href="{% static 'image/home/Magnet logo.png' %}">
     <!-- Bootstrap core CSS -->
     <link href="{% static 'css/home/bootstrap.min.css' %}" rel="stylesheet" type="text/css">
     <!--Custom CSS-->
     <link href="{% static 'css/home/style.css' %}" rel="stylesheet" type="text/css">
     <!--Plugin CSS-->
     <link href="{% static 'css/home/plugin.css' %}" rel="stylesheet" type="text/css">

    <!--Font Awesome-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css">
    <!-- <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"> -->

 
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"> -->
    <!-- <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script> -->

    <link rel="stylesheet" href="{% static 'css/home/fonts/line-icons.css' %}" type="text/css">
</head>

    <!-- Preloader -->
    <div id="preloader">
        <div id="status"></div>
    </div>
    <!-- Preloader Ends -->

    <!-- header starts -->
    {% include 'home/header.html' %}
    <!-- header ends -->

    <!-- BreadCrumb Ends --> 
    <button type="button" id="timeOutBtn" class="btn btn-primary d-none" data-bs-toggle="modal" data-bs-target="#exampleModalCenter3">
        Timeout
    </button>
    <div class="modal fade" id="exampleModalCenter3" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header justify-content-center">
              <h3 class="modal-title theme" id="exampleModalLabel">Timeout</h3>
            </div>
            <div class="modal-body p-2">
                <div id="customPopup" class="container popup">
                    <div class="popup-content col-md-12 text-center">
                        <img src="/VFpages/static/image/booking/Timeout.png" alt="">
                        <p class="mt-2" mt-2="">Your session has timed out. Please try again.</p>
                    </div>
                </div>
            </div>
            <!-- <div class="modal-footer">
                <a href="{% url 'hotel' %}"><button type="button" class="btn btn-secondary">Ok</button></a>
            </div> -->
          </div>
        </div>
      </div>

      <div class="modal fade" id="exampleModalCenter2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable p-2" style="max-width: 650px;">
        <div class="modal-content" style="border-radius: 4px;">
            <div class="modal-header">
            <h5 class="modal-title theme2 fs-4" id="exampleModalLongTitle"><img src="{% static 'image/booking/cancel-pic.png' %}" class="me-1" alt="" style="width: 20px;margin-bottom: 4px;"> Cancellation Policy</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body border-t bg-grey ">
                <div class="">
                    <p class="cp_refund theme" style="font-size: 14px;">Full Refund Allowed</p>
                    <table class="cancel_table text-start">
                        <thead>
                            <tr class="t_head">
                                <th>Cancelled on or After</th>
                                <th>Cancelled on or Before</th>
                                <th>Cancellation Charges</th>
                            </tr>
                        </thead>
                        <input type="hidden" id="CancellationPolicies" value="{{ details.CancellationPolicies }}">
                        <tbody id="cancellationPoliciesTableBody">
                            <tr>
                                <td>16-Dec-2023 00:00:00</td>
                                <td>18-Dec-2023 23:59:59</td>
                                <td>4029 Amount Charges.</td>
                            </tr>
                        </tbody>
                    </table>
                   
                    <div  class="cp_list mt-2">
                        <li>No Show will attract full cancellation charge unless otherwise specified.</li>
                        <li>Early check out will attract full cancellation charge unless otherwise specified.</li>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>

    <!-- top Destination starts -->
    <section class="trending pt-6 pb-0 bg-lgrey">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mb-4">
                    <div class="payment-book">
                        <div class="booking-box">
                            <!-- <div class="customer-information mb-4 d-flex align-items-center bg-grey rounded p-4">
                                <i class="fa fa-grin-wink rounded fs-1 bg-theme white p-3 px-4"></i>
                            </div> -->
                         
                            <!--Cancel Popup Btn-->
                            <!-- <div class="text-end">
                                <button type="button" class="black mb-2 bg-white can-btn text-decoration-underline" data-toggle="modal" data-target="#exampleModalCenter">
                                   <img src="{% static 'image/booking/cancel-pic.png' %}" class="me-1" alt="" style="width: 20px;margin-bottom: 4px;"> Cancellation Policy
                                </button>
                            </div> -->
                            <div class="text-end mb-2">
                                <button class="black mb-2 bg-white can-btn text-decoration-underline" style="font-size: 14px;"  type="button"  data-bs-toggle="modal" data-bs-target="#exampleModalCenter2" >
                                <img src="{% static 'image/booking/cancel-pic.png' %}" class="me-1" alt="" style="width: 20px;margin-bottom: 4px;"> Cancellation Policy</button>
                            </div>
                            <a href="" style="display: none;"><p>{{ details.cancellation_policy }}</p></a>
                           

                            <input type="hidden" class="block_book" name="block_book" placeholder="block_book" value="{{ current_time }}">
                            <input type="hidden" class="hide_123_val" name="hide_123_val" placeholder="block_book" value="{{ future_time }}">
                            <input type="hidden" class="category_id" name="category_id" placeholder="category_id" value="{{ category_id }}">
                            <div class="customer-information mb-4">
                               
                                <form class="mb-2"  method="POST" action="{% url 'previewpage' %}" id="paymentForm" onsubmit="return validateForm()">
                                    {% csrf_token %}
                                    <div class="bg-white rounded box-shadow  p-4" >
                                    <h3 class=" theme mb-1">Traveller Information</h3>
                                        <div class="pt-1 border-t">
                                            <h4 class="heading mb-1">Contact Details</h4>
                                            <p class="theme2">Please enter user name and mobile number where you would like to receive your confirmation.</p>
                                        </div>
                                        <div class="row mt-2">
                                            <div class="input-box col-lg-4 mb-1">
                                                <input type="text" class="username f-inp" name="user_name" placeholder="Enter Your Name" value="">
                                                <span class="error" id="nameError"></span>
                                            </div>
                                            <div class="input-box  col-lg-4 mb-1">
                                                <input type="text" class="phone_number f-inp" name="phone_number" placeholder="Enter Your Number" value="" >
                                                <span class="error" id="phoneError"></span>
                                            </div>
                                            <div class="input-box  col-lg-4 mb-1">
                                                <input type="text" class="email f-inp" name="email" placeholder="Enter Your Email" value="" >
                                                <span class="error" id="emailError"></span>
                                            </div>
                                        </div>
                                        <div>
                                            <input type="hidden" class="published_amount" name="published_amount" placeholder="User Name" value="{{ details.total_price }}">
                                            <input type="hidden" class="payment_flag" name="payment_flag" placeholder="User Name" value="process">
                                            <input type="hidden" class="payment_id" name="payment_id" placeholder="User Name" value="1a2c">
                                            <input type="hidden" class="room_information" name="room_information" placeholder="User Name" value="{{ details }}">
                                            <input type="hidden" id="curTime" name="curTime">
                                            <input type="hidden" class="payed_amount" name="payed_amount" placeholder="User Name" value="0">
                                        </div>
                                        <div id="guestDetailsContainer">
                                            <div>
                                                <h2 class="heading">Guest Information</h2>
                                                <p class="u_heading">Enter the details of the guest</p>
                                            </div>
                                        </div>
                                        <div class="input-box mt-2">
                                            <p class="theme2">Special Request (Optional)</p>
                                            <textarea name="req" class="f-inp" id="req" cols="50" rows="5"></textarea>
                                        </div>
                                        <input type="hidden" class="room_information" name="user_information" placeholder="User Name" value="">
                                        <div id="hiddenGuestData" style="display: none;">{{ personsdetails }}</div>
                                    </div>
                                    <div class="text-end mt-2">
                                        <button type="submit" id="myButton" onclick="sendit()" class="nir-btn float-lg-end">Proceed To Preview</button>
                                    </div>
                                </form>
                            </div>
                            
                        </div>
                    </div>
                </div>

                <div class="col-lg-4 mb-4 ps-ld-4">
                    <div class="sidebar-sticky">
                        <div class="sidebar-item bg-white rounded box-shadow overflow-hidden p-3 mb-4">
                            <h4>Pricing Details</h4>
                            <table>
                                <tbody>
                                    <tr>
                                        <td>Base Fare ({{ details.totalrooms }}Room X {{ details.No_of_Night }}Night)</td>
                                        <td class="theme2 text-end">INR {{ details.published_price }}</td>
                                    </tr>
                                    <tr>
                                        <td>Taxes and Fees</td>
                                        <td class="theme2 text-end">INR {{ details.final_tax }}</td>
                                    </tr>
                                    <tr>
                                        <td>Total Price</td>
                                        <td class="theme2 text-end">INR {{ details.total_price }}</td>
                                    </tr>
                                   
                                </tbody>
                                <tfoot class="bg-title">
                                    <tr>
                                        <th class="font-weight-bold white">Your Price</th>
                                        <th class="font-weight-bold white">INR {{ details.total_price }}</th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="sidebar-item bg-white rounded box-shadow overflow-hidden p-3 mb-4">
                            <h4>Hotel Summary</h4>
                            <div class="trend-full border-b">
                                <div class="row">
                                    <div class="">
                                        <div class="trend-content position-relative">
                                            <h5 class="mb-1"><a href="grid-leftfilter.html">{{ details.hotel_name }}</a></h5>
                                            <div class="rating star-view mb-1">
                                                {% for star in "12345" %}
                                                <span class="fa fa-star {% if forloop.counter <= details.rating %}checked{% else %}unchecked{% endif %}"></span>
                                               {% endfor %}
                                            </div>
                                            <h6 class="mb-2">{{ details.address }}</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="trend-check border-b pb-2">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="trend-check-item bg-grey rounded p-3 mb-2">
                                            <p class="mb-0">Check In</p>
                                            <h6 class="mb-0">{{ details.check_in_date }}</h6>
                                            <!-- <small>15:00 - 22:00</small> -->
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="trend-check-item bg-grey rounded p-3 mb-2">
                                            <p class="mb-0">Check Out</p>
                                            <h6 class="mb-0">{{ details.check_out_date }}</h6>
                                            <!-- <small>1:00 - 10:00</small> -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="trend-check border-b pb-2">
                                <p class="mb-0">Night(s)</p>
                                <h6 class="mb-0">{{ details.No_of_Night }} </h6>
                                <!-- <small><a href="#" class="theme text-decoration-underline">travelling on different dates?</a></small> -->
                            </div>
                            <div class="trend-check">
                                <!-- <p class="mb-0">You Selected:</p> -->
                                <h6 class="mb-0">Adults <span class="float-end fw-normal">{{ details.adults }}</span> </h6>
                                <h6 class="mb-0">Children <span class="float-end fw-normal">{{ details.childs }}</span> </h6>
                                <!-- <small><a href="#" class="theme text-decoration-underline">Change your selection</a></small> -->
                            </div>

                        </div>  
                        
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- top Destination ends -->

    <!-- Discount action Ends -->

    <footer id="footer" class="text-center container-fluid mt-3 mb-1" style="position: sticky;bottom: 0; z-index: 1;">
        <p class="mb-0 py-2" id="timer">Time remaining: 10:00</p>
    </footer>
  

    <!-- footer starts -->
    {% include 'home/footer.html' %}
    <!-- footer ends -->
    
    <!-- Back to top start -->
    <div id="back-to-top">
        <a href="#"></a>
    </div>
    <!-- Back to top ends -->

   <!-- Input css -->
   <style>
    .f-inp {
        border: 1px solid #d3cdcd !important;
        padding: 12px 15px !important;
        border-radius: 4px !important;
    }

    table>thead tr th, table>tbody tr td {
       font-size: 14px;
       background: white;
    }

    .cp_list li{
      font-size: 14px;
    }

    .fa-star.checked {
            color: orange;
        }

        .fa-star.unchecked {
            color: #ccc;
        }
   </style>

    <script src="{% static 'js/home/jquery-3.5.1.min.js' %}"></script>
    <script src="{% static 'js/home/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/home/particles.js' %}"></script>
    <script src="{% static 'js/home/particlerun.js' %}"></script>
    <script src="{% static 'js/home/plugin.js' %}"></script>
    <script src="{% static 'js/home/main.js' %}"></script>
    <script src="{% static 'js/home/custom-accordian.js' %}"></script>
    <script src="{% static 'js/home/custom-nav.js' %}"></script>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script> -->

    <script>
        // Sample data similar to details.CancellationPolicies
        var cancellationPoliciesString = document.getElementById("CancellationPolicies").value;
        var cancellationPolicies = JSON.parse(cancellationPoliciesString);
        console.log(cancellationPolicies)
        
        // Function to generate <tr> elements dynamically
        function generateCancellationPolicyRows() {
            var tableBody = document.getElementById("cancellationPoliciesTableBody");
            var tableRows = "";
        
            // Loop over cancellation policies and generate <tr> elements
            cancellationPolicies.forEach(function(policy) {
                // Format FromDate and ToDate
                var fromDate = new Date(policy.FromDate).toLocaleString('en-US', {day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit'});
                var toDate = new Date(policy.ToDate).toLocaleString('en-US', {day: '2-digit', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit'});
        
                var row = `
                    <tr>
                        <td>${fromDate}</td>
                        <td>${toDate}</td>
                        <td>${policy.Charge} ${policy.Currency} Amount Charges.</td>
                    </tr>
                `;
                tableRows += row;
            });
        
            // Update the table body with generated rows
            tableBody.innerHTML = tableRows;
        }
        
        // Call the function to generate rows
        generateCancellationPolicyRows();
    </script>
       <script>
        function validateForm() {
        var valid = true;

        document.getElementById('nameError').innerText = '';
        document.getElementById('phoneError').innerText = '';
        document.getElementById('emailError').innerText = '';

        var nameInput = document.querySelector('.username');
        var phoneInput = document.querySelector('.phone_number');
        var emailInput = document.querySelector('.email');

        var name = nameInput.value;
        var phone = phoneInput.value;
        var email = emailInput.value;

        if (name.trim() === '') {
            document.getElementById('nameError').innerText = 'Name is required';
            nameInput.style.border = '1px solid red';
            valid = false;
        } else {
            nameInput.style.border = ''; // Reset border style if valid
        }

        var phonePattern = /^\d{10}$/;
        if (phone.trim() === '') {
            document.getElementById('phoneError').innerText = 'Phone number is required';
            phoneInput.style.border = '1px solid red';
            valid = false;
        } else if (!phonePattern.test(phone)) {
            document.getElementById('phoneError').innerText = 'Invalid phone number';
            phoneInput.style.border = '1px solid red';
            valid = false;
        } else {
            phoneInput.style.border = ''; // Reset border style if valid
        }

        var emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (email.trim() === '') {
            document.getElementById('emailError').innerText = 'Email is required';
            emailInput.style.border = '1px solid red';
            valid = false;
        } else if (!emailPattern.test(email)) {
            document.getElementById('emailError').innerText = 'Invalid email address';
            emailInput.style.border = '1px solid red';
            valid = false;
        } else {
            emailInput.style.border = ''; // Reset border style if valid
        }

        guestData.forEach(function (room, roomIndex) {
        for (var i = 0; i < room.NoOfAdults; i++) {
            var adultFirstName = document.querySelector(`[name="room_${roomIndex + 1}_adult_${i + 1}_first_name"]`);
            var adultLastName = document.querySelector(`[name="room_${roomIndex + 1}_adult_${i + 1}_last_name"]`);

            if (adultFirstName.value.trim() === '') {
                document.getElementById(`firstNameError_${roomIndex + 1}_adult_${i + 1}`).innerText = 'Please Enter the first name';
                adultFirstName.style.border = '1px solid red';
                valid = false;
            } else {
                adultFirstName.style.border = '';
                document.getElementById(`firstNameError_${roomIndex + 1}_adult_${i + 1}`).innerText = ' '; // Reset border style if valid
            }

            if (adultLastName.value.trim() === '') {
                document.getElementById(`lastNameError_${roomIndex + 1}_adult_${i + 1}`).innerText = 'Please Enter the last name';
                adultLastName.style.border = '1px solid red';
                valid = false;
            } else {
                adultLastName.style.border = ''; // Reset border style if valid
                document.getElementById(`lastNameError_${roomIndex + 1}_adult_${i + 1}`).innerText = ' ';
            }
        }

        for (var j = 0; j < room.NoOfChild; j++) {
            var childFirstName = document.querySelector(`[name="room_${roomIndex + 1}_child_${j + 1}_first_name"]`);
            var childLastName = document.querySelector(`[name="room_${roomIndex + 1}_child_${j + 1}_last_name"]`);

            if (childFirstName.value.trim() === '') {
                document.getElementById(`cfirstNameError_${roomIndex + 1}_child_${j + 1}`).innerText = 'Please Enter the first name';
                childFirstName.style.border = '1px solid red';
                valid = false;
            } else {
                childFirstName.style.border = ''; // Reset border style if valid
                document.getElementById(`cfirstNameError_${roomIndex + 1}_child_${j + 1}`).innerText = ' ';
            }

            if (childLastName.value.trim() === '') {
                document.getElementById(`clastNameError_${roomIndex + 1}_child_${j + 1}`).innerText = 'Please Enter the last name';
                childLastName.style.border = '1px solid red';
                valid = false;
            } else {
                childLastName.style.border = ''; // Reset border style if valid
                document.getElementById(`clastNameError_${roomIndex + 1}_child_${j + 1}`).innerText = ' ';
            }
        }
    });


        var specialRequest = document.getElementById('req').value;

        return valid;
    }
    </script>
<script>
    var personsdetails = document.getElementById('hiddenGuestData').textContent;
    var guestData = JSON.parse(personsdetails || "[]");

    console.log(guestData);

    function generateRoomDetails() {
        var container = document.getElementById('guestDetailsContainer');
        container.innerHTML = ''; // Clear existing content

        var leadPassengerAssigned = false; // Flag to track lead passenger assignment

        guestData.forEach(function (room, roomIndex) {
            var roomElement = document.createElement('div');
            roomElement.className = 'mt-2';
            roomElement.innerHTML = `<h3 class="theme">Room ${roomIndex + 1}</h3>`;

            for (var i = 0; i < room.NoOfAdults; i++) {
                var adultElement = document.createElement('div');
                adultElement.className = 'my-2';
                
                // Assign lead passenger only if it hasn't been assigned yet
                var leadCustomerText = (!leadPassengerAssigned && i === 0 && roomIndex === 0) ? '- Lead Passenger' : '';
                var leadpassenger = (!leadPassengerAssigned && i === 0 && roomIndex === 0) ? 0 : 1;
                
                if (!leadPassengerAssigned && i === 0 && roomIndex === 0) {
                    leadPassengerAssigned = true;
                }
                
                adultElement.innerHTML = `
                    <div class="">
                        <h4 class="name_no theme2">Adult ${i + 1} <span style="color: orange;">${leadCustomerText}</span></h4>
                    </div>
                    <div class="row">
                        <div class="col-lg-2 mb-1">
                            <select class="f-inp" style="height:50px;" name="room_${roomIndex + 1}_adult_${i + 1}_gender">
                                <option value="Mr">Mr</option>
                                <option value="Mrs">Mrs</option>
                                <option value="Miss">Miss</option>
                                <option value="Ms">Ms</option>
                            </select>
                        </div>
                        <div class="col-lg-5 mb-1">
                            <input type="text" class="f-inp" placeholder="Enter Your First Name" name="room_${roomIndex + 1}_adult_${i + 1}_first_name">
                            <span class="error" id="firstNameError_${roomIndex + 1}_adult_${i + 1}"></span>
                        </div>
                        <div class="col-lg-5 mb-1">
                            <input type="text" class="f-inp" placeholder="Enter Your Last Name" name="room_${roomIndex + 1}_adult_${i + 1}_last_name">
                            <span class="error" id="lastNameError_${roomIndex + 1}_adult_${i + 1}"></span>
                        </div>
                        <input type="hidden" name="room_${roomIndex + 1}_adult_${i + 1}_age" value="0">
                        <input type="hidden" name="leadpassenger_${roomIndex + 1}_adult_${i + 1}" value="${leadpassenger}">
                    </div>`;

                roomElement.appendChild(adultElement);
            }

            for (var j = 0; j < room.NoOfChild; j++) {
                var childElement = document.createElement('div');
                childElement.className = 'mt-2';
                childElement.innerHTML = `
                    <div class="row">
                        <h4 class="name_no theme2">Child ${j + 1}</h4>
                    </div>
                    <div class="row">
                        <div class="col-lg-2 mb-1">
                            <select class="f-inp" style="height:50px;" name="room_${roomIndex + 1}_child_${j + 1}_gender">
                                <option value="Mr">Mr</option>
                                <option value="Mrs">Mrs</option>
                                <option value="Miss">Miss</option>
                                <option value="Ms">Ms</option>
                            </select>
                        </div>
                        <div class="col-lg-5 mb-1">
                            <input class="f-inp" type="text" placeholder="Enter Your First Name" name="room_${roomIndex + 1}_child_${j + 1}_first_name">
                            <span class="error" id="cfirstNameError_${roomIndex + 1}_child_${j + 1}"></span>
                        </div>
                        <div class="col-lg-5 mb-1">
                            <input class="f-inp" type="text" placeholder="Enter Your Last Name" name="room_${roomIndex + 1}_child_${j + 1}_last_name">
                            <span class="error" id="clastNameError_${roomIndex + 1}_child_${j + 1}"></span>
                        </div>
                        <div class="col-md-0" style="display:none">
                            <input class="f-inp" type="hidden" name="room_${roomIndex + 1}_child_${j + 1}_ChildAge" value="${room.ChildAge[j]}">
                            <input type="hidden" name="leadpassenger_${roomIndex + 1}_child_${j + 1}" value="1">
                        </div>
                    </div>`;

                roomElement.appendChild(childElement);
            }

            container.appendChild(roomElement);
        });
    }
    generateRoomDetails();
</script>

    <script>
        document.getElementById('myButton').addEventListener('click', function () {
            if (validateForm()) {
            // Collect adult and child details from the form
        
            var adultChildDetails = [];
            guestData.forEach(function (room, roomIndex) {
                var roomDetails = {
                    adults: [],
                    children: []
                };

                for (var i = 0; i < room.NoOfAdults; i++) {
                    var adultDetails = {
                        gender: document.querySelector(`[name="room_${roomIndex + 1}_adult_${i + 1}_gender"]`).value,
                        firstName: document.querySelector(`[name="room_${roomIndex + 1}_adult_${i + 1}_first_name"]`).value,
                        lastName: document.querySelector(`[name="room_${roomIndex + 1}_adult_${i + 1}_last_name"]`).value,
                        age: document.querySelector(`[name="room_${roomIndex + 1}_adult_${i + 1}_age"]`).value,
                        leadpassenger: document.querySelector(`[name="leadpassenger_${roomIndex + 1}_adult_${i + 1}"]`).value
                    };
                    roomDetails.adults.push(adultDetails);
                }

                for (var j = 0; j < room.NoOfChild; j++) {
                    var childDetails = {
                        gender: document.querySelector(`[name="room_${roomIndex + 1}_child_${j + 1}_gender"]`).value,
                        firstName: document.querySelector(`[name="room_${roomIndex + 1}_child_${j + 1}_first_name"]`).value,
                        lastName: document.querySelector(`[name="room_${roomIndex + 1}_child_${j + 1}_last_name"]`).value,
                        age: document.querySelector(`[name="room_${roomIndex + 1}_child_${j + 1}_ChildAge"]`).value,
                        leadpassenger: document.querySelector(`[name="leadpassenger_${roomIndex + 1}_child_${j + 1}"]`).value
                    };
                    roomDetails.children.push(childDetails);
                }

                // Add room details to the array
                adultChildDetails.push({
                    ['room' + (roomIndex + 1)]: roomDetails
                });
            });
    

            var jsonString = JSON.stringify(adultChildDetails);
            // Submit the form
            document.querySelector('[name="user_information"]').value = jsonString;
            document.querySelector('form').submit();
        } else {
            return false;
        }
    });
    </script>
    <script>
        const timeoutDuration = 10 * 60 * 1000; // 10 minutes
        let timeoutTimer;

        function updateTimerDisplay(timeRemaining) {
            const minutes = Math.floor(timeRemaining / 60000);
            const seconds = Math.floor((timeRemaining % 60000) / 1000);
            const formattedTime = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            document.getElementById("timer").innerText = `Time remaining: ${formattedTime}`;
        }

        function resetTimer() {
            clearTimeout(timeoutTimer);
            let timeRemaining = timeoutDuration;

            function update() {
                updateTimerDisplay(timeRemaining);
                timeRemaining -= 1000;

                if (timeRemaining < 0) {
                 $("#timeOutBtn").click();
                    updateTimerDisplay(0); 
                    setTimeout(function() {
                        window.location.href = "{% url 'hotel' %}"; // Replace with the desired URL
                    }, 2000);
                } else {
                    timeoutTimer = setTimeout(update, 1000);
                }
            }

            update();
        }
            
        resetTimer();

        
    </script> 
     <script>
        function sendit() {
            if (validateForm()) {
              
                var currentTime = new Date();
                var currentTimeWithSec = currentTime.toString().slice(4, 24);

                var contime = currentTimeWithSec;

                document.getElementById('curTime').value = contime;

                var form = document.createElement('form');
                form.method = 'POST';
                form.action = '/hotelbooked/';

                // Get values of hidden inputs
                var blockBook = document.querySelector('.block_book').value;
                var hide123Val = document.querySelector('.hide_123_val').value;
                var categoryId = document.querySelector('.category_id').value;

                // Append hidden input fields to the form
                var blockBookField = document.createElement('input');
                blockBookField.type = 'hidden';
                blockBookField.name = 'block_book';
                blockBookField.value = blockBook;
                form.appendChild(blockBookField);

                var hide123ValField = document.createElement('input');
                hide123ValField.type = 'hidden';
                hide123ValField.name = 'hide_123_val';
                hide123ValField.value = hide123Val;
                form.appendChild(hide123ValField);

                var categoryIdField = document.createElement('input');
                categoryIdField.type = 'hidden';
                categoryIdField.name = 'category_id';
                categoryIdField.value = categoryId;
                form.appendChild(categoryIdField);

                // // Add hidden input field for current time with seconds
                // var currentTimeField = document.createElement('input');
                // currentTimeField.type = 'hidden';
                // currentTimeField.name = 'current_time';
                // currentTimeField.value = currentTimeWithSec;
                // form.appendChild(currentTimeField);
                
                // Rest of your existing code
                // ...
                document.body.appendChild(form);
                form.submit();
                document.getElementById('preloader').style.display = 'block';
                document.getElementById('status').style.display = 'block';
            }
        }
    </script>

       
   
</body>
</html>